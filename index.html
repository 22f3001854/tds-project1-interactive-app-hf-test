<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Dashboard HF Test</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      padding: 20px;
    }
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
    }
    #loadingOverlay.show {
      display: flex;
    }
  </style>
</head>
<body>
  <div id="loadingOverlay" class="show">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div class="container">
    <h1 class="mb-4 text-center">Interactive Dashboard</h1>
    <div class="row mb-4">
      <div class="col-md-6">
        <label for="dataSelect" class="form-label">Select Data Set</label>
        <select class="form-select" id="dataSelect">
          <option value="sample1">Sample Data 1</option>
          <option value="sample2">Sample Data 2</option>
          <option value="sample3">Sample Data 3</option>
        </select>
      </div>
      <div class="col-md-6 d-flex align-items-end justify-content-center">
        <button class="btn btn-primary me-2" id="loadDataBtn">Load Data</button>
        <button class="btn btn-secondary" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">Data Visualization</div>
      <div class="card-body">
        <canvas id="myChart" height="400"></canvas>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">Markdown Editor</div>
      <div class="card-body">
        <div class="mb-3">
          <label for="markdownInput" class="form-label">Enter Markdown</label>
          <textarea class="form-control" id="markdownInput" rows="6" placeholder="Type markdown here..."></textarea>
        </div>
        <button class="btn btn-success mb-3" id="renderMarkdownBtn">Render Markdown</button>
        <div id="markdownPreview" class="border p-3" style="min-height:100px;">Markdown preview will appear here.</div>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">Image to Text (OCR)</div>
      <div class="card-body">
        <input class="form-control mb-3" type="file" id="imageInput" accept="image/*" />
        <button class="btn btn-primary mb-3" id="performOCRBtn">Perform OCR</button>
        <div class="border p-3" style="min-height:100px;" id="ocrResult">OCR result will appear here.</div>
      </div>
    </div>
  </div>

  <!-- Dependencies -->
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loadingOverlay = document.getElementById('loadingOverlay');
      const dataSelect = document.getElementById('dataSelect');
      const loadDataBtn = document.getElementById('loadDataBtn');
      const resetBtn = document.getElementById('resetBtn');
      const ctx = document.getElementById('myChart').getContext('2d');
      const markdownInput = document.getElementById('markdownInput');
      const renderMarkdownBtn = document.getElementById('renderMarkdownBtn');
      const markdownPreview = document.getElementById('markdownPreview');
      const imageInput = document.getElementById('imageInput');
      const performOCRBtn = document.getElementById('performOCRBtn');
      const ocrResult = document.getElementById('ocrResult');

      let chartInstance = null;

      // Show loading overlay
      function showLoading(show) {
        if (show) {
          loadingOverlay.classList.add('show');
        } else {
          loadingOverlay.classList.remove('show');
        }
      }

      // Parse URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const initialData = urlParams.get('url') || null;

      // Initialize
      function init() {
        // If URL parameter exists, load corresponding data
        if (initialData) {
          // For demo purposes, just set the select value to match
          // In real case, might fetch data from URL or handle accordingly
          // Here, we simulate loading data
          alert('Loading data from URL parameter: ' + initialData);
        }
        // Load initial chart
        loadChart(getSampleData('sample1'));
      }

      // Sample data sets
      function getSampleData(name) {
        switch(name) {
          case 'sample1':
            return {
              labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
              data: [65, 59, 80, 81, 56, 55, 40]
            };
          case 'sample2':
            return {
              labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
              data: [12, 19, 3, 5, 2, 3, 7]
            };
          case 'sample3':
            return {
              labels: ['Q1', 'Q2', 'Q3', 'Q4'],
              data: [15000, 20000, 18000, 22000]
            };
          default:
            return {
              labels: [],
              data: []
            };
        }
      }

      // Load chart with data
      function loadChart(data) {
        if (chartInstance) {
          chartInstance.destroy();
        }
        chartInstance = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'Sample Data',
              data: data.data,
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false }
            }
          }
        });
      }

      // Handle Load Data button
      document.getElementById('loadDataBtn').addEventListener('click', () => {
        showLoading(true);
        try {
          const selected = dataSelect.value;
          const data = getSampleData(selected);
          loadChart(data);
        } catch (e) {
          alert('Error loading data: ' + e.message);
        } finally {
          showLoading(false);
        }
      });

      // Handle Reset button
      document.getElementById('resetBtn').addEventListener('click', () => {
        dataSelect.value = 'sample1';
        loadChart(getSampleData('sample1'));
        markdownInput.value = '';
        markdownPreview.innerHTML = 'Markdown preview will appear here.';
        ocrResult.innerHTML = 'OCR result will appear here.';
        imageInput.value = '';
      });

      // Handle Render Markdown
      document.getElementById('renderMarkdownBtn').addEventListener('click', () => {
        const mdText = markdownInput.value;
        try {
          const html = marked.parse(mdText);
          markdownPreview.innerHTML = html;
        } catch (e) {
          markdownPreview.innerHTML = '<p class="text-danger">Error parsing markdown.</p>';
        }
      });

      // Handle Perform OCR
      document.getElementById('performOCRBtn').addEventListener('click', () => {
        const file = imageInput.files[0];
        if (!file) {
          alert('Please select an image file.');
          return;
        }
        showLoading(true);
        ocrResult.innerHTML = 'Processing image...';
        Tesseract.recognize(
          file,
          'eng',
          { logger: m => console.log(m) }
        ).then(({ data: { text } }) => {
          ocrResult.innerHTML = '<pre>' + text + '</pre>';
        }).catch(e => {
          ocrResult.innerHTML = '<p class="text-danger">Error performing OCR